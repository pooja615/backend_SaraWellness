<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sara Wellness Chatbot - Health Chat</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fsarawelln3380back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-surface min-h-screen font-source">
    <!-- Main Container -->
    <div class="min-h-screen flex flex-col">
        <!-- Header Section -->
        <header class="bg-white border-b border-slate-200 px-4 py-3 sticky top-0 z-10">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <!-- Logo and Title -->
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-inter font-semibold text-text-primary">Sara Wellness</h1>
                        <div class="flex items-center text-xs text-text-secondary">
                            <div class="w-2 h-2 bg-accent-500 rounded-full mr-1 animate-gentle-pulse"></div>
                            <span id="connectionStatus">Online</span>
                        </div>
                    </div>
                </div>

                <!-- Header Actions -->
                <div class="flex items-center space-x-2">
                    <!-- Language Switcher -->
                    <div class="relative">
                        <select id="headerLanguageSelect" class="text-sm border border-slate-200 rounded-lg px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="ne">नेपाली</option>
                            <option value="en">English</option>
                            <option value="hi">हिन्दी</option>
                            <option value="mai">मैथिली</option>
                        </select>
                    </div>

                    <!-- Emergency Button -->
                    <button onclick="showEmergencyContacts()" class="medical-button-secondary text-xs px-3 py-1 text-error-600 border-error-200 hover:bg-error-50">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        <span id="emergencyText">आपातकाल</span>
                    </button>

                    <!-- Menu Button -->
                    <button onclick="toggleSidebar()" class="medical-button-secondary p-2 lg:hidden">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Desktop Sidebar -->
            <aside id="sidebar" class="hidden lg:flex lg:w-80 bg-white border-r border-slate-200 flex-col">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-slate-200">
                    <h2 class="font-inter font-medium text-text-primary mb-3" id="sidebarTitle">स्वास्थ्य संसाधन</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <a href="conversation_history_health_summary.html" class="medical-button-secondary text-xs py-2 text-center">
                            <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="historyLink">इतिहास</span>
                        </a>
                        <a href="health_resource_directory.html" class="medical-button-secondary text-xs py-2 text-center">
                            <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m4 0v-5a1 1 0 011-1h4a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                            <span id="resourcesLink">संसाधन</span>
                        </a>
                    </div>
                </div>

                <!-- Recent Conversations -->
                <div class="flex-1 p-4 overflow-y-auto">
                    <h3 class="text-sm font-medium text-text-secondary mb-3" id="recentChatsTitle">हालैका कुराकानी</h3>
                    <div class="space-y-2" id="recentChatsList">
                        <div class="p-3 rounded-lg bg-slate-50 hover:bg-slate-100 cursor-pointer transition-colors">
                            <div class="text-sm font-medium text-text-primary mb-1">टाउको दुखाइ</div>
                            <div class="text-xs text-text-secondary">२ घण्टा अगाडि</div>
                        </div>
                        <div class="p-3 rounded-lg bg-slate-50 hover:bg-slate-100 cursor-pointer transition-colors">
                            <div class="text-sm font-medium text-text-primary mb-1">पेट दुखाइ</div>
                            <div class="text-xs text-text-secondary">१ दिन अगाडि</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Mobile Sidebar Overlay -->
            <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 lg:hidden hidden" onclick="toggleSidebar()"></div>
            <aside id="mobileSidebar" class="fixed left-0 top-0 h-full w-80 bg-white z-30 transform -translate-x-full transition-transform duration-300 lg:hidden">
                <div class="p-4 border-b border-slate-200 flex items-center justify-between">
                    <h2 class="font-inter font-medium text-text-primary" id="mobileSidebarTitle">स्वास्थ्य संसाधन</h2>
                    <button onclick="toggleSidebar()" class="p-2 hover:bg-slate-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-1 gap-3 mb-6">
                        <a href="conversation_history_health_summary.html" class="medical-button-secondary py-3 text-center">
                            <svg class="w-5 h-5 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="mobileHistoryLink">कुराकानी इतिहास</span>
                        </a>
                        <a href="health_resource_directory.html" class="medical-button-secondary py-3 text-center">
                            <svg class="w-5 h-5 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m4 0v-5a1 1 0 011-1h4a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                            <span id="mobileResourcesLink">स्वास्थ्य संसाधन</span>
                        </a>
                        <a href="image_upload_analysis.html" class="medical-button-secondary py-3 text-center">
                            <svg class="w-5 h-5 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span id="mobileImageLink">फोटो विश्लेषण</span>
                        </a>
                    </div>
                </div>
            </aside>

            <!-- Chat Container -->
            <main class="flex-1 flex flex-col">
                <!-- Medical Disclaimer Banner -->
                <div class="bg-warning-50 border-b border-warning-200 px-4 py-2">
                    <div class="max-w-4xl mx-auto flex items-center text-sm">
                        <svg class="w-4 h-4 text-warning-600 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                        </svg>
                        <span class="text-warning-800" id="disclaimerBanner">यो चैटबट चिकित्सकको विकल्प होइन। गम्भीर समस्याका लागि डाक्टरको सल्लाह लिनुहोस्।</span>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div class="max-w-4xl mx-auto">
                        <!-- Welcome Message -->
                        <div class="flex items-start space-x-3 mb-6">
                            <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                            <div class="medical-card p-4 max-w-md">
                                <p class="text-text-primary" id="welcomeMessage">
                                    नमस्कार! म Sara हुँ, तपाईंको स्वास्थ्य सहायक। म तपाईंलाई स्वास्थ्य सम्बन्धी जानकारी र मार्गदर्शन प्रदान गर्न यहाँ छु। तपाईंको स्वास्थ्य चिन्ता के हो?
                                </p>
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <button onclick="sendQuickReply('टाउको दुखाइ')" class="medical-button-secondary text-xs px-3 py-1">टाउको दुखाइ</button>
                                    <button onclick="sendQuickReply('पेट दुखाइ')" class="medical-button-secondary text-xs px-3 py-1">पेट दुखाइ</button>
                                    <button onclick="sendQuickReply('ज्वरो')" class="medical-button-secondary text-xs px-3 py-1">ज्वरो</button>
                                    <button onclick="sendQuickReply('खोकी')" class="medical-button-secondary text-xs px-3 py-1">खोकी</button>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages will be dynamically added here -->
                        <div id="messagesContainer"></div>

                        <!-- Typing Indicator -->
                        <div id="typingIndicator" class="flex items-start space-x-3 hidden">
                            <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                            <div class="medical-card p-4">
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-primary-600 rounded-full animate-bounce"></div>
                                    <div class="w-2 h-2 bg-primary-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                    <div class="w-2 h-2 bg-primary-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    <span class="text-text-secondary text-sm ml-2" id="typingText">टाइप गर्दै...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-slate-200 bg-white p-4">
                    <div class="max-w-4xl mx-auto">
                        <!-- File Upload Progress -->
                        <div id="uploadProgress" class="hidden mb-3">
                            <div class="medical-card p-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-text-secondary" id="uploadingText">अपलोड गर्दै...</span>
                                    <span class="text-sm text-text-secondary" id="uploadPercent">0%</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div id="progressBar" class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Input Form -->
                        <form id="chatForm" class="flex items-end space-x-3">
                            <!-- File Upload -->
                            <div class="relative">
                                <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleFileUpload(event)" />
                                <button type="button" onclick="document.getElementById('fileInput').click()" class="medical-button-secondary p-3 hover:bg-primary-50 hover:text-primary-600 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Text Input -->
                            <div class="flex-1">
                                <textarea id="messageInput" rows="1" placeholder="आफ्नो स्वास्थ्य चिन्ता लेख्नुहोस्..." class="medical-input resize-none min-h-[48px] max-h-32 py-3" onkeydown="handleKeyDown(event)" oninput="autoResize(this)"></textarea>
                            </div>

                            <!-- Send Button -->
                            <button type="submit" id="sendButton" class="medical-button-primary p-3 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </button>
                        </form>

                        <!-- Quick Actions -->
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button onclick="sendQuickReply('मानसिक स्वास्थ्य')" class="medical-button-secondary text-xs px-3 py-1">मानसिक स्वास्थ्य</button>
                            <button onclick="sendQuickReply('औषधि जानकारी')" class="medical-button-secondary text-xs px-3 py-1">औषधि जानकारी</button>
                            <button onclick="sendQuickReply('पोषण सल्लाह')" class="medical-button-secondary text-xs px-3 py-1">पोषण सल्लाह</button>
                            <button onclick="sendQuickReply('व्यायाम')" class="medical-button-secondary text-xs px-3 py-1">व्यायाम</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Emergency Contacts Modal -->
    <div id="emergencyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="medical-card max-w-md w-full p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-inter font-semibold text-text-primary" id="emergencyModalTitle">आपतकालीन सम्पर्क</h3>
                <button onclick="closeEmergencyModal()" class="p-2 hover:bg-slate-100 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-error-50 rounded-lg">
                    <span class="text-text-primary font-medium">एम्बुलेन्स</span>
                    <a href="tel:102" class="medical-button-primary px-4 py-2 text-sm">102</a>
                </div>
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-text-primary font-medium">पुलिस</span>
                    <a href="tel:100" class="medical-button-secondary px-4 py-2 text-sm">100</a>
                </div>
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-text-primary font-medium">दमकल</span>
                    <a href="tel:101" class="medical-button-secondary px-4 py-2 text-sm">101</a>
                </div>
            </div>
            <div class="mt-4 p-3 bg-warning-50 border border-warning-200 rounded-lg">
                <p class="text-sm text-warning-800" id="emergencyNote">
                    जीवनलाई खतरा हुने अवस्थामा तुरुन्त 102 मा कल गर्नुहोस्।
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- JavaScript -->
    <script>
        // Language content object
        const languageContent = {
            ne: {
                connectionStatus: 'Online',
                emergencyText: 'आपातकाल',
                sidebarTitle: 'स्वास्थ्य संसाधन',
                historyLink: 'इतिहास',
                resourcesLink: 'संसाधन',
                recentChatsTitle: 'हालैका कुराकानी',
                disclaimerBanner: 'यो चैटबट चिकित्सकको विकल्प होइन। गम्भीर समस्याका लागि डाक्टरको सल्लाह लिनुहोस्।',
                welcomeMessage: 'नमस्कार! म Sara हुँ, तपाईंको स्वास्थ्य सहायक। म तपाईंलाई स्वास्थ्य सम्बन्धी जानकारी र मार्गदर्शन प्रदान गर्न यहाँ छु। तपाईंको स्वास्थ्य चिन्ता के हो?',
                typingText: 'टाइप गर्दै...',
                uploadingText: 'अपलोड गर्दै...',
                emergencyModalTitle: 'आपतकालीन सम्पर्क',
                emergencyNote: 'जीवनलाई खतरा हुने अवस्थामा तुरुन्त 102 मा कल गर्नुहोस्।',
                messagePlaceholder: 'आफ्नो स्वास्थ्य चिन्ता लेख्नुहोस्...'
            },
            en: {
                connectionStatus: 'Online',
                emergencyText: 'Emergency',
                sidebarTitle: 'Health Resources',
                historyLink: 'History',
                resourcesLink: 'Resources',
                recentChatsTitle: 'Recent Chats',
                disclaimerBanner: 'This chatbot is not a substitute for a doctor. Consult a physician for serious problems.',
                welcomeMessage: 'Hello! I am Sara, your health assistant. I am here to provide you with health-related information and guidance. What is your health concern?',
                typingText: 'Typing...',
                uploadingText: 'Uploading...',
                emergencyModalTitle: 'Emergency Contacts',
                emergencyNote: 'Call 102 immediately in life-threatening situations.',
                messagePlaceholder: 'Type your health concern...'
            },
            hi: {
                connectionStatus: 'ऑनलाइन',
                emergencyText: 'आपातकाल',
                sidebarTitle: 'स्वास्थ्य संसाधन',
                historyLink: 'इतिहास',
                resourcesLink: 'संसाधन',
                recentChatsTitle: 'हाल की बातचीत',
                disclaimerBanner: 'यह चैटबॉट डॉक्टर का विकल्प नहीं है। गंभीर समस्याओं के लिए चिकित्सक से सलाह लें।',
                welcomeMessage: 'नमस्कार! मैं Sara हूँ, आपकी स्वास्थ्य सहायक। मैं आपको स्वास्थ्य संबंधी जानकारी और मार्गदर्शन प्रदान करने के लिए यहाँ हूँ। आपकी स्वास्थ्य चिंता क्या है?',
                typingText: 'टाइप कर रहे हैं...',
                uploadingText: 'अपलोड कर रहे हैं...',
                emergencyModalTitle: 'आपातकालीन संपर्क',
                emergencyNote: 'जीवन के लिए खतरनाक स्थिति में तुरंत 102 पर कॉल करें।',
                messagePlaceholder: 'अपनी स्वास्थ्य चिंता लिखें...'
            },
            mai: {
                connectionStatus: 'ऑनलाइन',
                emergencyText: 'आपातकाल',
                sidebarTitle: 'स्वास्थ्य संसाधन',
                historyLink: 'इतिहास',
                resourcesLink: 'संसाधन',
                recentChatsTitle: 'हालक बातचीत',
                disclaimerBanner: 'ई चैटबॉट डॉक्टरक विकल्प नहि अछि। गंभीर समस्याक लेल चिकित्सकसँ सलाह लिअ।',
                welcomeMessage: 'नमस्कार! हम Sara छी, अहाँक स्वास्थ्य सहायक। हम अहाँकेँ स्वास्थ्य संबंधी जानकारी आ मार्गदर्शन प्रदान करबाक लेल एतय छी। अहाँक स्वास्थ्य चिंता की अछि?',
                typingText: 'टाइप कऽ रहल छी...',
                uploadingText: 'अपलोड कऽ रहल छी...',
                emergencyModalTitle: 'आपातकालीन संपर्क',
                emergencyNote: 'जीवनकेँ खतरा भेलापर तुरंत 102 पर कॉल करू।',
                messagePlaceholder: 'अपन स्वास्थ्य चिंता लिखू...'
            }
        };

        // Global variables
        let currentLanguage = 'ne';
        let conversationHistory = [];
        let isTyping = false;
        let uploadedImage = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved language preference
            const savedLang = localStorage.getItem('selectedLanguage') || 'ne';
            currentLanguage = savedLang;
            document.getElementById('headerLanguageSelect').value = savedLang;
            updateLanguageContent();

            // Load conversation history
            loadConversationHistory();

            // Enable send button when input has content
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                const sendButton = document.getElementById('sendButton');
                sendButton.disabled = this.value.trim() === '';
            });

            // Check connection status
            updateConnectionStatus();
            setInterval(updateConnectionStatus, 30000); // Check every 30 seconds
        });

        // Language switching
        document.getElementById('headerLanguageSelect').addEventListener('change', function() {
            currentLanguage = this.value;
            localStorage.setItem('selectedLanguage', currentLanguage);
            updateLanguageContent();
        });

        // Update language content
        function updateLanguageContent() {
            const content = languageContent[currentLanguage];
            
            // Update all text elements
            document.getElementById('connectionStatus').textContent = content.connectionStatus;
            document.getElementById('emergencyText').textContent = content.emergencyText;
            document.getElementById('sidebarTitle').textContent = content.sidebarTitle;
            document.getElementById('historyLink').textContent = content.historyLink;
            document.getElementById('resourcesLink').textContent = content.resourcesLink;
            document.getElementById('recentChatsTitle').textContent = content.recentChatsTitle;
            document.getElementById('disclaimerBanner').textContent = content.disclaimerBanner;
            document.getElementById('welcomeMessage').textContent = content.welcomeMessage;
            document.getElementById('typingText').textContent = content.typingText;
            document.getElementById('emergencyModalTitle').textContent = content.emergencyModalTitle;
            document.getElementById('emergencyNote').textContent = content.emergencyNote;
            document.getElementById('messageInput').placeholder = content.messagePlaceholder;

            // Update mobile sidebar
            if (document.getElementById('mobileSidebarTitle')) {
                document.getElementById('mobileSidebarTitle').textContent = content.sidebarTitle;
                document.getElementById('mobileHistoryLink').textContent = content.historyLink;
                document.getElementById('mobileResourcesLink').textContent = content.resourcesLink;
                document.getElementById('mobileImageLink').textContent = 'फोटो विश्लेषण';
            }
        }

        // Chat form submission
        document.getElementById('chatForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message) {
                sendMessage(message);
                messageInput.value = '';
                document.getElementById('sendButton').disabled = true;
                autoResize(messageInput);
            }
        });

        // Send message function
        function sendMessage(message) {
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate bot response after delay
            setTimeout(() => {
                hideTypingIndicator();
                generateBotResponse(message);
            }, 1500 + Math.random() * 1000);

            // Save to conversation history
            conversationHistory.push({
                type: 'user',
                message: message,
                timestamp: new Date().toISOString()
            });
            saveConversationHistory();
        }

        // Quick reply function
        function sendQuickReply(message) {
            sendMessage(message);
        }

        // Add message to chat
        function addMessageToChat(message, sender) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            
            if (sender === 'user') {
                messageDiv.className = 'flex justify-end mb-4';
                messageDiv.innerHTML = `
                    <div class="max-w-md bg-primary-600 text-white p-4 rounded-xl rounded-br-md">
                        <p>${message}</p>
                        <div class="text-xs text-primary-100 mt-2">${formatTime(new Date())}</div>
                    </div>
                `;
            } else {
                messageDiv.className = 'flex items-start space-x-3 mb-4 animate-slide-in-right';
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <div class="medical-card p-4 max-w-md">
                        <p class="text-text-primary">${message}</p>
                        <div class="text-xs text-text-secondary mt-2">${formatTime(new Date())}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // Generate bot response
        function generateBotResponse(userMessage) {
            let response = '';
            const lowerMessage = userMessage.toLowerCase();
            
            // Health condition responses
            if (lowerMessage.includes('टाउको दुखाइ') || lowerMessage.includes('headache')) {
                response = getHealthResponse('headache');
            } else if (lowerMessage.includes('पेट दुखाइ') || lowerMessage.includes('stomach')) {
                response = getHealthResponse('stomach');
            } else if (lowerMessage.includes('ज्वरो') || lowerMessage.includes('fever')) {
                response = getHealthResponse('fever');
            } else if (lowerMessage.includes('खोकी') || lowerMessage.includes('cough')) {
                response = getHealthResponse('cough');
            } else if (lowerMessage.includes('मानसिक') || lowerMessage.includes('mental')) {
                response = getHealthResponse('mental');
            } else {
                response = getGeneralHealthResponse();
            }
            
            addMessageToChat(response, 'bot');
            
            // Save bot response to history
            conversationHistory.push({
                type: 'bot',
                message: response,
                timestamp: new Date().toISOString()
            });
            saveConversationHistory();
        }

        // Health response generator
        function getHealthResponse(condition) {
            const responses = {
                headache: {
                    ne: 'टाउको दुखाइको बारेमा बुझ्न चाहन्छु। यो कहिलेदेखि सुरु भयो? दुखाइ कस्तो छ - तीव्र, हल्का, वा धड्कने जस्तो? के तपाईंले हालै तनाव, निद्राको कमी, वा खानाको समयमा परिवर्तन गर्नुभएको छ?',
                    en: 'I want to understand about your headache. When did it start? What kind of pain is it - sharp, mild, or throbbing? Have you recently experienced stress, lack of sleep, or changes in meal times?'
                },
                stomach: {
                    ne: 'पेट दुखाइको बारेमा थप जान्न चाहन्छु। दुखाइ पेटको कुन भागमा छ? के यो खाना खाएपछि बढ्छ? के तपाईंलाई वाकवाकी, बान्ता, वा पखाला पनि भएको छ?',
                    en: 'I want to know more about your stomach pain. Which part of the stomach hurts? Does it increase after eating? Do you also have nausea, vomiting, or diarrhea?'
                },
                fever: {
                    ne: 'ज्वरोको बारेमा जानकारी चाहिन्छ। तापक्रम कति छ? के तपाईंलाई चिसो लाग्छ, पसिना आउँछ? अन्य लक्षणहरू जस्तै खोकी, घाँटी दुख्ने, वा शरीर दुख्ने छ?',
                    en: 'I need information about the fever. What is the temperature? Do you feel cold or sweat? Are there other symptoms like cough, sore throat, or body aches?'
                },
                cough: {
                    ne: 'खोकीको बारेमा बुझ्न चाहन्छु। यो सुख्खा खोकी हो कि कफ सहितको? कति दिनदेखि छ? के रातमा बढी हुन्छ? सास फेर्न गाह्रो छ?',
                    en: 'I want to understand about the cough. Is it a dry cough or with phlegm? How many days has it been? Does it increase at night? Is it difficult to breathe?'
                },
                mental: {
                    ne: 'मानसिक स्वास्थ्यको बारेमा कुरा गर्न धन्यवाद। तपाईं कस्तो महसुस गरिरहनुभएको छ? के तनाव, चिन्ता, वा उदासी छ? निद्रा र खानामा परिवर्तन भएको छ?',
                    en: 'Thank you for talking about mental health. How are you feeling? Do you have stress, anxiety, or sadness? Have there been changes in sleep and appetite?'
                }
            };
            
            return responses[condition][currentLanguage] || responses[condition]['ne'];
        }

        // General health response
        function getGeneralHealthResponse() {
            const responses = {
                ne: 'तपाईंको स्वास्थ्य चिन्ताको बारेमा थप जान्न चाहन्छु। कृपया आफ्ना लक्षणहरू विस्तारमा भन्नुहोस्। यो कहिलेदेखि सुरु भयो र कस्तो महसुस हुन्छ?',
                en: 'I want to know more about your health concern. Please describe your symptoms in detail. When did it start and how does it feel?',
                hi: 'मैं आपकी स्वास्थ्य चिंता के बारे में और जानना चाहता हूँ। कृपया अपने लक्षणों का विस्तार से वर्णन करें। यह कब से शुरू हुआ और कैसा लगता है?',
                mai: 'हम अहाँक स्वास्थ्य चिंताक बारेमे आओर जानब चाहैत छी। कृपया अपन लक्षणक विस्तारसँ वर्णन करू। ई कहियासँ शुरू भेल आ कहन लगैत अछि?'
            };
            
            return responses[currentLanguage] || responses['ne'];
        }

        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('कृपया केवल फोटो फाइल अपलोड गर्नुहोस्।', 'error');
                return;
            }

            // Validate file size (5MB limit)
            if (file.size > 5 * 1024 * 1024) {
                showToast('फाइल साइज 5MB भन्दा कम हुनुपर्छ।', 'error');
                return;
            }

            // Show upload progress
            showUploadProgress();
            
            // Simulate upload progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 30;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        hideUploadProgress();
                        handleImageAnalysis(file);
                    }, 500);
                }
                updateUploadProgress(progress);
            }, 200);
        }

        // Show upload progress
        function showUploadProgress() {
            document.getElementById('uploadProgress').classList.remove('hidden');
            document.getElementById('uploadingText').textContent = languageContent[currentLanguage].uploadingText;
        }

        // Hide upload progress
        function hideUploadProgress() {
            document.getElementById('uploadProgress').classList.add('hidden');
        }

        // Update upload progress
        function updateUploadProgress(percent) {
            document.getElementById('uploadPercent').textContent = Math.round(percent) + '%';
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Handle image analysis
        function handleImageAnalysis(file) {
            uploadedImage = file;
            
            // Add image message to chat
            const reader = new FileReader();
            reader.onload = function(e) {
                addImageMessageToChat(e.target.result, file.name);
                
                // Simulate analysis
                setTimeout(() => {
                    const analysisResponse = getImageAnalysisResponse();
                    addMessageToChat(analysisResponse, 'bot');
                }, 2000);
            };
            reader.readAsDataURL(file);
        }

        // Add image message to chat
        function addImageMessageToChat(imageSrc, fileName) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'flex justify-end mb-4';
            messageDiv.innerHTML = `
                <div class="max-w-md bg-primary-600 text-white p-4 rounded-xl rounded-br-md">
                    <img src="${imageSrc}" alt="${fileName}" class="w-full h-48 object-cover rounded-lg mb-2">
                    <p class="text-sm">फोटो अपलोड गरियो: ${fileName}</p>
                    <div class="text-xs text-primary-100 mt-2">${formatTime(new Date())}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // Get image analysis response
        function getImageAnalysisResponse() {
            const responses = {
                ne: 'तपाईंले अपलोड गर्नुभएको फोटो हेरें। यदि यो स्वास्थ्य सम्बन्धी समस्याको फोटो हो भने, कृपया थप विवरण दिनुहोस्। के दुखाइ छ? कहिलेदेखि यस्तो छ? यो फोटो मात्रबाट पूर्ण निदान गर्न सकिँदैन, त्यसैले डाक्टरको जाँच गराउनु राम्रो हुन्छ।',
                en: 'I have seen the photo you uploaded. If this is a photo of a health-related problem, please provide more details. Is there pain? How long has it been like this? Complete diagnosis cannot be made from this photo alone, so it would be good to get examined by a doctor.',
                hi: 'मैंने आपके द्वारा अपलोड की गई फोटो देखी है। यदि यह किसी स्वास्थ्य समस्या की फोटो है, तो कृपया अधिक विवरण दें। क्या दर्द है? यह कब से ऐसा है? केवल इस फोटो से पूर्ण निदान नहीं किया जा सकता, इसलिए डॉक्टर से जांच कराना अच्छा होगा।',
                mai: 'हम अहाँक अपलोड कएल फोटो देखलहुँ। यदि ई कोनो स्वास्थ्य समस्याक फोटो अछि तँ कृपया आओर विवरण दिअ। की दर्द अछि? ई कहियासँ एहन अछि? केवल एहि फोटोसँ पूर्ण निदान नहि कएल जा सकैत अछि, तेँ डॉक्टरसँ जाँच कराएब नीक हएत।'
            };
            
            return responses[currentLanguage] || responses['ne'];
        }

        // Typing indicator functions
        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('hidden');
            isTyping = true;
            scrollToBottom();
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('hidden');
            isTyping = false;
        }

        // Auto-resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 128) + 'px';
        }

        // Handle keyboard shortcuts
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                document.getElementById('chatForm').dispatchEvent(new Event('submit'));
            }
        }

        // Sidebar functions
        function toggleSidebar() {
            const overlay = document.getElementById('sidebarOverlay');
            const sidebar = document.getElementById('mobileSidebar');
            
            if (overlay.classList.contains('hidden')) {
                overlay.classList.remove('hidden');
                sidebar.classList.remove('-translate-x-full');
            } else {
                overlay.classList.add('hidden');
                sidebar.classList.add('-translate-x-full');
            }
        }

        // Emergency modal functions
        function showEmergencyContacts() {
            document.getElementById('emergencyModal').classList.remove('hidden');
        }

        function closeEmergencyModal() {
            document.getElementById('emergencyModal').classList.add('hidden');
        }

        // Toast notification function
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const bgColor = type === 'error' ? 'bg-error-50 border-error-200 text-error-800' : 
                           type === 'success' ? 'bg-success-50 border-success-200 text-success-800' :
                           'bg-primary-50 border-primary-200 text-primary-800';
            
            toast.className = `medical-toast ${bgColor} border`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Hide and remove toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toastContainer.removeChild(toast), 300);
            }, 4000);
        }

        // Utility functions
        function formatTime(date) {
            return date.toLocaleTimeString('ne-NP', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 100);
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            const isOnline = navigator.onLine;
            
            if (isOnline) {
                statusElement.textContent = languageContent[currentLanguage].connectionStatus;
                statusElement.previousElementSibling.classList.remove('bg-error-600');
                statusElement.previousElementSibling.classList.add('bg-accent-500');
            } else {
                statusElement.textContent = 'Offline';
                statusElement.previousElementSibling.classList.remove('bg-accent-500');
                statusElement.previousElementSibling.classList.add('bg-error-600');
            }
        }

        // Conversation history functions
        function saveConversationHistory() {
            localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
        }

        function loadConversationHistory() {
            const saved = localStorage.getItem('conversationHistory');
            if (saved) {
                conversationHistory = JSON.parse(saved);
            }
        }

        // Listen for online/offline events
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);

        // Close modals on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEmergencyModal();
                if (!document.getElementById('sidebarOverlay').classList.contains('hidden')) {
                    toggleSidebar();
                }
            }
        });

        // Prevent form submission on file input
        document.getElementById('fileInput').addEventListener('change', function(e) {
            e.stopPropagation();
        });

        // Initialize connection status check
        updateConnectionStatus();
    </script>
</body>
</html>