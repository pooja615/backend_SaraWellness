<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sara Wellness | Testimonials</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="./style.css">

  <style>
    body { min-height: 100vh; background: #f7fbf9; }

    /* ===== Blue hero area ===== */
    .hero {
      position: relative;
      overflow: hidden;
      background: #1f86ff;
      height: auto;
      padding: 54px 0 56px;
      border-bottom: 1px solid rgba(255, 255, 255, .25);
    }

    .hero:before {
      content: "";
      position: absolute;
      inset: -60px;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.14) 0 18%, transparent 19% 100%),
        radial-gradient(circle at 68% 30%, rgba(255,255,255,.10) 0 16%, transparent 17% 100%),
        radial-gradient(circle at 32% 82%, rgba(255,255,255,.12) 0 14%, transparent 15% 100%),
        linear-gradient(135deg, rgba(255,255,255,.08), transparent 55%);
      opacity: 0.55;
      pointer-events: none;
    }

    .hero-inner {
      position: relative;
      text-align: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 48px);
      font-weight: 900;
      letter-spacing: 0.2px;
      color: #ff2a4a;
      text-shadow: 0 10px 25px rgba(0, 0, 0, .18);
    }

    .hero .underline {
      width: 96px;
      height: 4px;
      border-radius: 999px;
      background: #ffd400;
      margin: 14px auto 0;
      box-shadow: 0 10px 20px rgba(0, 0, 0, .18);
    }

    /* ✅ Cards can grow to multiple rows naturally */
    .cards-wrap { margin-top: 38px; }

    .t-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 22px;
      margin-top: 18px;
      align-items: stretch;
      /* no max-height / no overflow limits */
    }

    @media (max-width: 1100px) {
      .t-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 700px) {
      .t-grid { grid-template-columns: 1fr; }
    }

    .t-card {
      background: #fff;
      border-radius: 18px;
      padding: 26px 26px 22px;
      border: 1px solid rgba(0, 0, 0, .06);
      box-shadow: 0 18px 46px rgba(0, 0, 0, .12);
      min-height: 250px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
    }

    .t-quote {
      position: absolute;
      left: 18px;
      top: 16px;
      font-size: 20px;
      color: rgba(255, 90, 120, 0.55);
      display: flex;
      gap: 6px;
    }

    .t-text {
      margin-top: 14px;
      font-style: italic;
      font-size: 18px;
      line-height: 1.9;
      color: #2a2a2a;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .t-rating {
      margin-top: -6px;
      font-weight: 900;
      color: #f5a524;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      font-size: 14px;
      justify-content: flex-start;
    }

    .t-rating span {
      color: #6b7280;
      font-weight: 800;
    }

    .t-bottom {
      margin-top: auto;
      display: flex;
      gap: 14px;
      align-items: center;
      text-align: left;
    }

    .t-avatar {
      width: 56px;
      height: 56px;
      border-radius: 999px;
      border: 3px solid #ff2a4a;
      overflow: hidden;
      flex: 0 0 auto;
      background: rgba(46, 139, 87, 0.08);
      display: grid;
      place-items: center;
    }

    .t-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .t-name {
      font-weight: 900;
      font-size: 20px;
      color: #222;
      line-height: 1.2;
      margin: 0;
    }

    .t-service {
      margin: 4px 0 0;
      color: #3f4b57;
      font-size: 16px;
      line-height: 1.2;
    }

    .status {
      margin-top: 16px;
      color: rgba(255,255,255,.92);
      font-weight: 700;
      text-align: center;
    }

    /* ===== Form area (no fixed page-wrap gap) ===== */
    .form-section { padding: 26px 0 70px; }
    .form-section.hide { display: none; } /* ✅ remove blank space when hidden */

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
      margin-bottom: 18px;
    }

    .topbar {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .topbar h2 { margin: 0; line-height: 1.1; font-size: 22px; }
    .topbar p { margin: 6px 0 0; color: #555; }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    @media (max-width: 850px) { .form-grid { grid-template-columns: 1fr; } }

    .field { display: flex; flex-direction: column; gap: 8px; }
    .field label { font-size: 14px; font-weight: 800; color: #333; }

    .field input,
    .field select,
    .field textarea {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.12);
      outline: none;
      background: #fff;
      transition: .2s ease;
    }

    .field textarea {
      min-height: 120px;
      resize: vertical;
      grid-column: 1 / -1;
    }

    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      border-color: rgba(46, 139, 87, 0.65);
      box-shadow: 0 0 0 4px rgba(46, 139, 87, 0.12);
    }

    .actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }

    .small { color: #666; font-size: 13px; line-height: 1.5; margin-top: 8px; }

    /* Alerts */
    .alert {
      display: none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      border: 1px solid transparent;
      line-height: 1.4;
    }

    .alert.error {
      display: block;
      background: rgba(220, 53, 69, 0.08);
      border-color: rgba(220, 53, 69, 0.25);
      color: #b02a37;
    }

    .alert.success {
      display: block;
      background: rgba(46, 139, 87, 0.10);
      border-color: rgba(46, 139, 87, 0.30);
      color: #1e6a42;
    }

    .alert i { margin-right: 8px; }
    footer a { text-decoration: none; }
  </style>
</head>

<body>
  <div id="header-placeholder"></div>

  <!-- Blue area: heading + cards -->
  <section class="hero">
    <div class="hero-inner">
      <h1>Client Testimonials</h1>
      <div class="underline"></div>
      <h3 style="margin: 20px auto 60px;">Hear from people who have transformed their lives through our wellness programs.</h3>

      <div class="cards-wrap">
        <div id="status" class="status">Loading testimonials...</div>
        <div id="alert" class="alert"></div>
        <div id="grid" class="t-grid"></div>
      </div>
    </div>
  </section>

  <!-- ✅ Form section (completely removed from layout if not shown) -->
  <section id="formSection" class="form-section hide">
    <div class="container">
      <div class="card">
        <div class="topbar">
          <div>
            <h2>Write a Testimonial</h2>
            <p>Your testimonial will be visible after admin approval.</p>
          </div>
        </div>

        <div id="submit-alert" class="alert"></div>

        <form id="testimonialForm" enctype="multipart/form-data">
          <div class="form-grid">
            <div class="field">
              <label for="service">Service *</label>
              <select id="service" name="service" required>
                <option value="" disabled selected>Select service</option>
                <option value="Weight Loss">Weight Loss</option>
                <option value="Hair Loss">Hair Loss</option>
                <option value="Skin Care">Skin Care</option>
                <option value="Stress Management">Stress Management</option>
                <option value="Pain Relief">Pain Relief</option>
                <option value="Personal Problems">Personal Problems</option>
              </select>
            </div>

            <div class="field">
              <label for="rating">Rating (1-5) *</label>
              <select id="rating" name="rating" required>
                <option value="" disabled selected>Select rating</option>
                <option value="5">5 - Excellent</option>
                <option value="4">4 - Very Good</option>
                <option value="3">3 - Good</option>
                <option value="2">2 - Fair</option>
                <option value="1">1 - Poor</option>
              </select>
            </div>

            <div class="field" style="grid-column: 1 / -1;">
              <label for="content">Your Experience *</label>
              <textarea id="content" name="content" placeholder="Write your testimonial..." required></textarea>
            </div>

            <div class="field" style="grid-column: 1 / -1;">
              <label for="image">Optional Photo</label>
              <input id="image" type="file" name="image" accept="image/*">
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="submitBtn" type="submit">
              <i class="fa-solid fa-paper-plane" style="margin-right:8px;"></i> Submit
            </button>
            <span class="small">Name is automatically taken from your login profile.</span>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
<footer>
  <div class="container">
    <div class="footer-container">

      <div class="footer-col">
        <h4>Sara Wellness</h4>
        <p>
          Holistic approaches to wellness that integrate physical health with mental wellbeing
          for a balanced, fulfilling life.
        </p>
      </div>

      <div class="footer-col">
        <h4>Services</h4>
        <ul>
          <li><a href="weight-loss.html">Weight Loss</a></li>
          <li><a href="hair-loss.html">Hair Loss</a></li>
          <li><a href="skin-care.html">Skin Care</a></li>
          <li><a href="stress-management.html">Stress Management</a></li>
          <li><a href="pain-relief.html">Pain Relief</a></li>
          <li><a href="personal-problems.html">Personal Problems</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="testimonials.html">Testimonials</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Newsletter</h4>
        <p>Subscribe to our newsletter for wellness tips and updates.</p>
        <form onsubmit="event.preventDefault(); alert('Thanks for subscribing!');">
          <input type="email" placeholder="Your Email" required>
          <button type="submit" class="btn">Subscribe</button>
        </form>
      </div>

    </div>

    <div class="copyright">
      <p>&copy; 2023 Sara Wellness. All rights reserved.</p>
    </div>
  </div>
</footer>


  <script>
    const API_BASE = "https://backend-sarawellness.onrender.com";

    const grid = document.getElementById("grid");
    const statusEl = document.getElementById("status");
    const alertEl = document.getElementById("alert");

    const formSection = document.getElementById("formSection");
    const submitForm = document.getElementById("testimonialForm");
    const submitAlert = document.getElementById("submit-alert");
    const submitBtn = document.getElementById("submitBtn");

    function getToken() { return localStorage.getItem("token"); }
    function getUser() {
      try { return JSON.parse(localStorage.getItem("user") || "null"); }
      catch { return null; }
    }
    function isNormalUser() {
      const u = getUser();
      return !!getToken() && (u?.role || "").toLowerCase() === "user";
    }

    function showAlert(el, type, message) {
      el.className = `alert ${type}`;
      el.innerHTML = type === "error"
        ? `<i class="fa-solid fa-triangle-exclamation"></i> ${message}`
        : `<i class="fa-solid fa-circle-check"></i> ${message}`;
      el.style.display = "block";
    }

    function hideAlert(el) {
      el.style.display = "none";
      el.className = "alert";
      el.innerHTML = "";
    }

    function escapeHtml(str) {
      return String(str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function resolveImageUrl(img) {
      if (!img) return "";
      let s = String(img).trim();
      if (!s) return "";
      s = s.replaceAll("\\", "/");
      if (s.startsWith("http://") || s.startsWith("https://")) return s;

      const idx = s.toLowerCase().indexOf("/uploads/");
      if (idx !== -1) s = s.slice(idx);

      if (s.toLowerCase().startsWith("uploads/")) s = "/" + s;
      return s.startsWith("/") ? `${API_BASE}${s}` : `${API_BASE}/${s}`;
    }

    function stars(rating) {
      const r = Math.max(1, Math.min(5, Number(rating || 0)));
      let out = "";
      for (let i = 1; i <= 5; i++) out += i <= r ? "★" : "☆";
      return out;
    }

    function render(list) {
      grid.innerHTML = "";
      hideAlert(alertEl);

      if (!list.length) {
        statusEl.textContent = "No testimonials available.";
        return;
      }

      // ✅ allow unlimited rows: no truncation, no "max 6", nothing
      statusEl.textContent = "";

      list.forEach(t => {
        const name = t.name || "Anonymous";
        const service = t.service || "Service";
        const content = t.content || "";
        const rating = t.rating || 5;
        const imgUrl = resolveImageUrl(t.image);

        const card = document.createElement("div");
        card.className = "t-card";

        card.innerHTML = `
          <div class="t-quote">
            <i class="fa-solid fa-quote-left"></i>
            <i class="fa-solid fa-quote-right"></i>
          </div>

          <div class="t-text">&quot;${escapeHtml(content)}&quot;</div>

          <div class="t-rating" title="Rating ${rating}/5">
            ${stars(rating)} <span>(${rating})</span>
          </div>

          <div class="t-bottom">
            <div class="t-avatar">
              ${imgUrl
                ? `<img src="${escapeHtml(imgUrl)}" alt="${escapeHtml(name)}"
                     onerror="this.parentElement.innerHTML='<i class=\\'fa-solid fa-user\\' style=\\'font-size:20px; color:#2E8B57;\\'></i>'">`
                : `<i class="fa-solid fa-user" style="font-size:20px; color:#2E8B57;"></i>`
              }
            </div>

            <div>
              <p class="t-name">${escapeHtml(name)}</p>
              <p class="t-service">${escapeHtml(service)}</p>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    async function fetchTestimonials() {
      statusEl.textContent = "Loading testimonials...";
      grid.innerHTML = "";
      hideAlert(alertEl);

      try {
        const res = await fetch(`${API_BASE}/api/testimonials`, { method: "GET" });
        let data = {};
        try { data = await res.json(); } catch { }

        if (!res.ok) {
          showAlert(alertEl, "error", data?.message || data?.error || `Failed (HTTP ${res.status})`);
          statusEl.textContent = "Unable to load testimonials.";
          return;
        }

        const list = Array.isArray(data) ? data : (data.testimonials || data.data || []);
        list.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
        render(list);
      } catch {
        showAlert(alertEl, "error", "Server not reachable. Make sure backend is running on localhost:5000.");
        statusEl.textContent = "Unable to load testimonials.";
      }
    }

    function setSubmitLoading(loading) {
      submitBtn.disabled = loading;
      submitBtn.style.opacity = loading ? "0.75" : "1";
      submitBtn.innerHTML = loading
        ? `<i class="fa-solid fa-spinner fa-spin" style="margin-right:8px;"></i> Submitting...`
        : `<i class="fa-solid fa-paper-plane" style="margin-right:8px;"></i> Submit`;
    }

    // Submit testimonial (role=user only)
    if (submitForm) {
      submitForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideAlert(submitAlert);

        const token = getToken();
        const u = getUser();

        if (!token || !u) {
          showAlert(submitAlert, "error", "Please login to submit a testimonial.");
          return;
        }
        if ((u.role || "").toLowerCase() !== "user") {
          showAlert(submitAlert, "error", "Only normal users can submit testimonials.");
          return;
        }

        const service = document.getElementById("service").value;
        const rating = document.getElementById("rating").value;
        const content = document.getElementById("content").value.trim();
        const imageFile = document.getElementById("image").files?.[0] || null;

        if (!service || !rating || !content) {
          showAlert(submitAlert, "error", "Service, rating and content are required.");
          return;
        }

        const fd = new FormData();
        fd.append("name", u.name);
        fd.append("service", service);
        fd.append("rating", rating);
        fd.append("content", content);
        if (imageFile) fd.append("image", imageFile);

        setSubmitLoading(true);

        try {
          const res = await fetch(`${API_BASE}/api/testimonials`, {
            method: "POST",
            headers: { Authorization: `Bearer ${token}` },
            body: fd,
          });

          let data = {};
          try { data = await res.json(); } catch { }

          if (!res.ok) {
            const msg = data?.message || data?.error || "Failed to submit testimonial.";
            showAlert(submitAlert, "error", msg);

            if (res.status === 401 && String(msg).toLowerCase().includes("no longer exists")) {
              localStorage.removeItem("token");
              localStorage.removeItem("user");
              setTimeout(() => window.location.href = "login.html", 800);
            }

            setSubmitLoading(false);
            return;
          }

          showAlert(submitAlert, "success", "Submitted successfully! Waiting for admin approval.");
          submitForm.reset();
          setSubmitLoading(false);

          fetchTestimonials();
        } catch {
          showAlert(submitAlert, "error", "Server not reachable. Make sure backend is running.");
          setSubmitLoading(false);
        }
      });
    }

    // ✅ Show form section only for role=user, otherwise remove it from layout (no blank space)
    (function initAuthUI() {
      if (isNormalUser()) {
        formSection.classList.remove("hide");
      } else {
        formSection.classList.add("hide");
      }
    })();

    fetchTestimonials();
  </script>

  <!-- Header loader (auth toggle + role link + active menu + burger) -->
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;

        function getToken() { return localStorage.getItem("token"); }
        function getUser() { try { return JSON.parse(localStorage.getItem("user") || "null"); } catch { return null; } }
        function isAdmin() { const u = getUser(); return (u?.role || "").toLowerCase() === "admin"; }

        const token = getToken();
        const guest1 = document.getElementById("nav-auth-guest");
        const guest2 = document.getElementById("nav-auth-guest-2");
        const userNav = document.getElementById("nav-auth-user");
        const roleLi = document.getElementById("nav-role-link");

        if (token) {
          if (guest1) guest1.style.display = "none";
          if (guest2) guest2.style.display = "none";
          if (userNav) userNav.style.display = "inline-block";

          if (roleLi) {
            roleLi.style.display = "inline-block";
            roleLi.innerHTML = isAdmin()
              ? `<a href="dashboard.html" data-nav="dashboard"><i class="fa-solid fa-gauge" style="margin-right:8px;"></i>Dashboard</a>`
              : `<a href="profile.html" data-nav="profile"><i class="fa-solid fa-user" style="margin-right:8px;"></i>Profile</a>`;
          }
        } else {
          if (guest1) guest1.style.display = "inline-block";
          if (guest2) guest2.style.display = "inline-block";
          if (userNav) userNav.style.display = "none";
          if (roleLi) roleLi.style.display = "none";
        }

        const logoutLink = document.getElementById("logout-link");
        if (logoutLink) {
          logoutLink.addEventListener("click", (e) => {
            e.preventDefault();
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            window.location.href = "login.html";
          });
        }

        const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();
        const map = {
          "index.html": "home",
          "services.html": "services",
          "about.html": "about",
          "testimonials.html": "testimonials",
          "blog.html": "blog",
          "contact.html": "contact",
          "login.html": "login",
          "register.html": "register",
          "profile.html": "profile",
          "dashboard.html": "dashboard"
        };
        const key = map[current];
        if (key) {
          const activeLink = document.querySelector(`.sw-nav a[data-nav="${key}"]`);
          if (activeLink) activeLink.classList.add("active");
        }

        const burger = document.getElementById("sw-burger");
        const nav = document.getElementById("sw-nav");
        if (burger && nav) {
          const closeMenu = () => {
            nav.classList.remove("open");
            burger.classList.remove("is-open");
            burger.setAttribute("aria-expanded", "false");
          };

          burger.addEventListener("click", () => {
            const open = nav.classList.toggle("open");
            burger.classList.toggle("is-open", open);
            burger.setAttribute("aria-expanded", open ? "true" : "false");
          });

          nav.addEventListener("click", (e) => {
            const a = e.target.closest("a");
            if (a && window.innerWidth <= 900) closeMenu();
          });

          window.addEventListener("resize", () => {
            if (window.innerWidth > 900) closeMenu();
          });

          document.addEventListener("click", (e) => {
            if (window.innerWidth > 900) return;
            if (!nav.classList.contains("open")) return;
            const inside = e.target.closest("#sw-nav") || e.target.closest("#sw-burger");
            if (!inside) closeMenu();
          });
        }
      });
  </script>

  <!-- ✅ Single-file reusable chatbot (NO fetch, NO extra files)
     Paste this near the END of <body> in ANY page.
     Requirements: FontAwesome link in <head> (optional, icons will fallback if missing)
-->

<style>
  /* ===== Sara Wellness Reusable Chatbot (Single-file) ===== */
  #sw-chatbot{position:fixed;bottom:30px;right:30px;z-index:9999}
  #sw-chatbot .sw-chatbot-btn{
    width:60px;height:60px;border-radius:50%;
    background:linear-gradient(135deg,#DC143C,#4B0082);
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-size:1.5rem;cursor:pointer;
    box-shadow:0 5px 15px rgba(0,0,0,.2);
    transition:transform .3s ease;animation:swPulse 2s infinite;
    user-select:none;
  }
  #sw-chatbot .sw-chatbot-btn:hover{transform:scale(1.1)}
  @keyframes swPulse{
    0%{box-shadow:0 0 0 0 rgba(220,20,60,.7)}
    70%{box-shadow:0 0 0 15px rgba(220,20,60,0)}
    100%{box-shadow:0 0 0 0 rgba(220,20,60,0)}
  }

  #sw-chatbot .sw-chatbot-window{
    position:absolute;bottom:70px;right:0;
    width:350px;height:450px;background:#fff;border-radius:15px;
    box-shadow:0 5px 25px rgba(0,0,0,.2);
    display:none;flex-direction:column;overflow:hidden;
    border:2px solid #DC143C;
  }
  #sw-chatbot .sw-chatbot-window.show{display:flex}

  #sw-chatbot .sw-chatbot-header{
    background:linear-gradient(135deg,#DC143C,#4B0082);
    color:#fff;padding:15px;display:flex;align-items:center;justify-content:space-between
  }
  #sw-chatbot .sw-chatbot-header h3{font-size:1rem;margin:0}
  #sw-chatbot .sw-close{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%}
  #sw-chatbot .sw-close:hover{background:rgba(255,255,255,.15)}

  #sw-chatbot .sw-messages{
    flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px
  }
  #sw-chatbot .sw-message{
    max-width:80%;padding:10px 15px;border-radius:20px;line-height:1.4;font-size:.95rem;white-space:pre-wrap
  }
  #sw-chatbot .sw-bot{background:#f1f1f1;align-self:flex-start;border-bottom-left-radius:6px;color:#343a40}
  #sw-chatbot .sw-user{background:#DC143C;color:#fff;align-self:flex-end;border-bottom-right-radius:6px}

  #sw-chatbot .sw-input{
    display:flex;gap:10px;padding:10px;border-top:1px solid #ddd;background:#fff
  }
  #sw-chatbot .sw-input input{
    flex:1;padding:10px;border:1px solid #ddd;border-radius:20px;outline:none
  }
  #sw-chatbot .sw-input button{
    width:40px;height:40px;border:none;border-radius:50%;
    background:#DC143C;color:#fff;cursor:pointer;flex:0 0 auto
  }

  @media (max-width:768px){
    #sw-chatbot{bottom:20px;right:20px}
    #sw-chatbot .sw-chatbot-window{width:300px;height:400px}
  }
</style>

<div id="sw-chatbot" aria-live="polite">
  <div class="sw-chatbot-btn" id="sw-chatbot-btn" aria-label="Open chat" role="button" tabindex="0">
    <i class="fas fa-comment-medical" aria-hidden="true"></i>
  </div>

  <div class="sw-chatbot-window" id="sw-chatbot-window" aria-hidden="true">
    <div class="sw-chatbot-header">
      <h3>Sara Wellness Assistant</h3>
      <span class="sw-close" id="sw-chatbot-close" aria-label="Close chat" role="button" tabindex="0">
        <i class="fas fa-times" aria-hidden="true"></i>
      </span>
    </div>

    <div class="sw-messages" id="sw-chatbot-messages">
      <div class="sw-message sw-bot">
        Hello! I'm Sara, your wellness assistant. You can ask me anything about our services: weight loss, hair loss, skin care, stress management, pain relief, or personal problems.
      </div>
    </div>

    <div class="sw-input">
      <input type="text" id="sw-user-input" placeholder="Type your question here..." autocomplete="off" />
      <button id="sw-send-btn" aria-label="Send message">
        <i class="fas fa-paper-plane" aria-hidden="true"></i>
      </button>
    </div>
  </div>
</div>

<script>
  (function () {
    // Avoid double-init if pasted twice
    if (window.__SW_CHATBOT_INIT__) return;
    window.__SW_CHATBOT_INIT__ = true;

    const btn = document.getElementById("sw-chatbot-btn");
    const win = document.getElementById("sw-chatbot-window");
    const closeBtn = document.getElementById("sw-chatbot-close");
    const input = document.getElementById("sw-user-input");
    const sendBtn = document.getElementById("sw-send-btn");
    const messages = document.getElementById("sw-chatbot-messages");

    function openChat() {
      win.classList.add("show");
      win.setAttribute("aria-hidden", "false");
      setTimeout(() => input && input.focus(), 50);
    }

    function closeChat() {
      win.classList.remove("show");
      win.setAttribute("aria-hidden", "true");
    }

    function addMessage(text, sender) {
      const el = document.createElement("div");
      el.className = "sw-message " + (sender === "user" ? "sw-user" : "sw-bot");
      el.textContent = text;
      messages.appendChild(el);
      messages.scrollTop = messages.scrollHeight;
    }

    function generateResponse(message) {
      const msg = String(message || "").toLowerCase();

      // Weight loss
      if (msg.includes("weight") || msg.includes("diet") || msg.includes("obese") || msg.includes("fat")) {
        return "Our weight loss program includes personalized diet plans, exercise routines, and lifestyle modifications. We focus on sustainable weight loss rather than quick fixes.";
      }

      // Hair loss
      if (msg.includes("hair") || msg.includes("bald") || msg.includes("scalp")) {
        return "We offer comprehensive hair loss treatments including scalp therapies, nutritional guidance, and natural remedies to promote hair growth and reduce hair fall.";
      }

      // Skin care
      if (msg.includes("skin") || msg.includes("acne") || msg.includes("pimple") || msg.includes("glow")) {
        return "Our skin care treatments address concerns like acne, aging, pigmentation, and dryness. We use a combination of advanced treatments and natural approaches.";
      }

      // Stress
      if (msg.includes("stress") || msg.includes("anxiety") || msg.includes("tension") || msg.includes("worry")) {
        return "Our stress management program includes counseling, relaxation techniques, mindfulness practices, and lifestyle adjustments to help you manage stress effectively.";
      }

      // Pain relief (fixed your old typo: imcludes -> includes)
      if (
        msg.includes("pain") ||
        msg.includes("joint") ||
        msg.includes("joints") ||
        msg.includes("sprain") ||
        msg.includes("shoulder") ||
        msg.includes("muscle") ||
        msg.includes("stomach ache")
      ) {
        return "Our pain relief service offers natural and holistic approaches to manage and relieve chronic pain, improving your quality of life through proven techniques.";
      }

      // Personal problems / general issues
      if (msg.includes("personal") || msg.includes("problem") || msg.includes("issue")) {
        return "We provide discreet support for sensitive personal concerns in a safe, confidential environment. For private guidance, please book a consultation via our contact page.";
      }

      // Appointment
      if (msg.includes("appointment") || msg.includes("schedule") || msg.includes("book") || msg.includes("meet")) {
        return "You can book an appointment by calling +977-15225050 or by using our contact page. Our staff will get back to you soon.";
      }

      // Price
      if (msg.includes("price") || msg.includes("cost") || msg.includes("fee") || msg.includes("charge")) {
        return "Pricing depends on the treatment plan. Please contact us for specific packages and consultation details.";
      }

      // Greetings
      if (msg.includes("hello") || msg.includes("hi") || msg.includes("hey") || msg.includes("namaste")) {
        return "Hello! How can I help you with your wellness journey today?";
      }

      if (msg.includes("thank")) {
        return "You're welcome! Is there anything else you'd like to know about our services?";
      }

      return "Thank you for your question. I can share info about our wellness services. For more specific help, please contact us directly.";
    }

    function sendMessage() {
      const text = (input.value || "").trim();
      if (!text) return;

      addMessage(text, "user");
      input.value = "";

      setTimeout(() => addMessage(generateResponse(text), "bot"), 600);
    }

    // Click handlers
    btn.addEventListener("click", openChat);
    closeBtn.addEventListener("click", closeChat);
    sendBtn.addEventListener("click", sendMessage);

    // Enter to send
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
      if (e.key === "Escape") closeChat();
    });

    // Allow keyboard access on open/close icons
    btn.addEventListener("keydown", (e) => { if (e.key === "Enter") openChat(); });
    closeBtn.addEventListener("keydown", (e) => { if (e.key === "Enter") closeChat(); });

    // Optional: ESC anywhere closes if open
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && win.classList.contains("show")) closeChat();
    });
  })();
</script>

</body>

</html>
